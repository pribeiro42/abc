<div class="section pv1 {{ .class }}" id="modal-grid">
        
    <div class="container">
            <div class="bg-grey-1 pv2 mv3-ns center">
                    <div class="ph3 mw7 center">
                        <h2 class="f2 b lh-title mb2 modalTitle">{{.title}}</h2>
                </div>
            </div>
            {{ range .rows }}
            <div class="row">
            {{ range .items }}

        <div class="col m6 s12">
          <a class="modal-trigger modalLinks">
            <div class="white content-block z-depth-3 " >
              <div class="img-wrap w-50 center split {{.key}}">
                <img src="{{.image}}"/>
              </div>
              <div class="pad center white split {{.key}}">
                <div class="caption">{{.heading}}</div>
              </div>
            </div>
          </a>
          <div id="{{.key}}" class="modal">
              <div class="modal-content">
                  <div class="modal-body">
                <button type="button" class="close close-btn" data-dismiss="modal" aria-label="Close"><span class="" aria-hidden="true">&times;</span></button>
                  {{if .carrousselSlides}}
                  <div id="{{.key}}Carousel" class="carousel slide pv4" data-ride="carousel" data-interval="false">
                      <ol class="carousel-indicators">
                          {{ range .carrousselSlides}}
                          <li data-target="#{{.key}}Carousel" data-slide-to="{{.nr}}"></li>
                          {{end}}
                      </ol>
                      <div class="carousel-inner">
                          {{ range .carrousselSlides}}
                          <div class="carousel-item {{if .first}}active{{end}}">
                              <img class="d-block w-100" src="{{.image}}" alt="First slide">
                              <div class="container">
                              <div class="carousel-caption text-left">
                                    <h2>{{.heading}}</h2>
                                    <p class="">{{.text}}</p>
                              </div>
                            </div>
                          </div>
                          {{end}}
                      </div>
                      <a class="carousel-control-prev" href="#{{.key}}Carousel" role="button" data-slide="prev">
                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                          <span class="sr-only">Previous</span>
                      </a>
                      <a class="carousel-control-next" href="#{{.key}}Carousel" role="button" data-slide="next">
                          <span class="carousel-control-next-icon" aria-hidden="true"></span>
                          <span class="sr-only">Next</span>
                      </a>
                  </div>
                  {{else}}
                  <div class="col s12 l5 hide-on-med-and-down">
                      <div class="img-wrap contentImage">
                          <img src="{{.image}}" />
                      </div>
                  </div>
                  <div class="col s12 l7">
                      <p>{{.content}}</p>
                  </div>
                  {{end}}
                  {{if .hasAvailableOffices}}
                  {{range .availableOffices}}
                  <div class="pv2 hashModalLink">
                      <h2><a href="{{ .url }}">{{.title}}</a></h2>
                  </div>
                  {{end}}
                  {{end}}
                  {{if .hasAvailableOffices}}
                  {{range .availableOffices}}
                  

                  <div id="{{.id}}" class="modal">
                        <div class="modal-content">
                            <div class="modal-body">
                          <button type="button" class="close close-btn" data-dismiss="modal" aria-label="Close"><span class="" aria-hidden="true">&times;</span></button>
                            {{if .carrousselSlides}}
                            <div id="availableOfficesCarousel" class="carousel slide pv4" data-ride="carousel" data-interval="false">
                                <ol class="carousel-indicators">
                                    {{ range .carrousselSlides}}
                                    <li data-target="#availableOfficesCarousel" data-slide-to="{{.nr}}"></li>
                                    {{end}}
                                </ol>
                                <div class="carousel-inner">
                                    {{ range .carrousselSlides}}
                                    <div class="carousel-item {{if .first}}active{{end}}">
                                        <img class="d-block w-100" src="{{.image}}" alt="First slide">
                                        <div class="container">
                                        <div class="carousel-caption text-left">
                                              <h2>{{.heading}}</h2>
                                              <p class="">{{.text}}</p>
                                        </div>
                                      </div>
                                    </div>
                                    {{end}}
                                </div>
                                <a class="carousel-control-prev" href="#availableOfficesCarousel" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Previous</span>
                                </a>
                                <a class="carousel-control-next" href="#availableOfficesCarousel" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </div>
                            {{else}}
                            <div class="col s12 l5 hide-on-med-and-down">
                                <div class="img-wrap contentImage">
                                    <img src="{{.image}}" />
                                </div>
                            </div>
                            <div class="col s12 l7">
                                <p>{{.content}}</p>
                            </div>
                            {{end}}
                            <div class="pv2 hashModalLink">
                                    <h2><a href="{{ .urlBack }}">{{.back}}</a></h2>
                                </div>
                        </div>
                      </div>
                    </div>
                  {{end}}
                  {{end}}
              </div>
            </div>
          </div>
        </div>
        {{ end }}
      </div>
      {{end}}
    </div>
  </div>
  <script>
      $(document).ready(function () {
          /********EVENTS*********/
        $('#modal-grid .modal-trigger').each(function(index,item){
            $(this).click(function(e){
                $(this).siblings('.modal').modal({
                    opacity: .5,
                    close: function () {$(this).destroy()},
                    height: 50,
                    width: 50,
                    dismissable: true,
                    backdrop: 'static'
                    // ready: function() {
                    // console.log("modal ready")
                    // }
                });
                $(".modal-backdrop").click(function(e){$('.modal').modal('hide')});
            });
        });
        $('.modal-close').click(function(e){
            $('.modal').modal('hide');
        });

        $(document).bind('keyup', function(e) {
        if(e.which == 39){
            $('.carousel').carousel('next');
        }
        else if(e.which == 37){
            $('.carousel').carousel('prev');
        }
    });

        /********CALLS*********/
        hideCarouselIndicators();
        $('.carousel').on('slid', '', hideCarouselIndicators);  // on caroussel move
        $('.carousel').on('slid.bs.carousel', '', hideCarouselIndicators); // on carousel move
        if ($('#availableOffices')){
            var availableOffices = $('#availableOffices');
                $('#availableOffices').remove()
                $('.row').eq(0).append(availableOffices);
                $('#availableOffices').modal({
                    opacity: .5,
                    close: function () {$(this).destroy()},
                    height: 50,
                    width: 50,
                    dismissable: true,
                    backdrop: 'static'
                    // ready: function() {
                    // console.log("modal ready")
                    // }
                });
                $('#availableOffices').modal('hide');
                $(".modal-backdrop").click(function(e){$('.modal').modal('hide')});
        }
        openModalFromNav();
    $('.hashModalLink a').click(openModalFromNav);
    animateContainer();
        /********FUNCTIONS*********/

        function decamelize(str, separator){
            separator = typeof separator === 'undefined' ? '_' : separator;

            return str
                .replace(/([a-z\d])([A-Z])/g, '$1' + separator + '$2')
                .replace(/([A-Z]+)([A-Z][a-z\d]+)/g, '$1' + separator + '$2')
                .toLowerCase();
        };

        function openModalFromNav(e){
            $('.modal').modal('hide')
            var query = e ? $(e.delegateTarget).attr('href') : false;
            if (query) {
                query = query.substring(query.lastIndexOf("/")+1);
                var jumpToAnchor = $(e.delegateTarget).parents(".jumpToAnchor");
                if (jumpToAnchor.length > 0){
                    var anchor =  query.substring(query.indexOf("#")+1);
                    anchor = decamelize(anchor,"_").split("_")[0];
                    $(document).scrollTop($('.' + anchor).offset().top );  
                }
                $(query).modal('show');
            }
            else 
            if (window.location.href.indexOf("#") > 0) {
                query = window.location.href.substring(window.location.href.indexOf("#")+1);
                if($('.dropdown').find('.jumpToAnchor').find( '#' + query)){
                    var anchor = '.' + query.substring(query.indexOf("#")+1);
                    anchor = decamelize(anchor,"_").split("_")[0];
                    $(document).scrollTop($(anchor).offset().top -100 );  
                }
                $('#' + query).modal('show');
            }
            $(".modal-backdrop").click(function(e){$('.modal').modal('hide')});

        }

        function hideCarouselIndicators()                   
        {
            var $this = $('.carousel');
            if($('.carousel-inner .carousel-item:first').hasClass('active')) {
                $this.children('.carousel-control-prev').hide();
                $this.children('.carousel-control-next').show();
            } else if($('.carousel-inner .carousel-item:last').hasClass('active')) {
                $this.children('.carousel-control-prev').show();
                $this.children('.carousel-control-next').hide();
            } else {
                $this.children('.carousel-control-prev').show();
                $this.children('.carousel-control-next').show();
            } 
        }

        function animateContainer () {
            $('.modalTitle').each(function(){
                $(this).html($(this).text().replace(/([^\a-\z]|\w)/g, "<span class='letter'>$&</span>"));
            });
            anime({
                targets: '.modalTitle .letter',
                scale: [4,1],
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 550,
                delay: function(el, i) {
                    return 60*i;
                }
            })
            var delay = 1000,
                factor = 1.15;
            $('.col .split').each(function(index,item){
                var classesSplit = "." + $(this).attr('class').split(" ")[$(this).attr('class').split(" ").length -1];
                anime({
                    targets: classesSplit,
                    scale: [4,1],
                    opacity: [0,1],
                    easing: "easeOutExpo",
                    duration: 1000 + delay,
                });
                delay *= factor;
            });
        }
    });
  </script>